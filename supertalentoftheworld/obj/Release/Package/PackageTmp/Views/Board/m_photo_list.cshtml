@using SmartFactory.Controllers
@using supertalentoftheworld.Models
@model IEnumerable<supertalentoftheworld.Models.BoardFile>

@{

    var ajaxOpts = new AjaxOptions
    {
        UpdateTargetId = "result"
    };
    SmartFactory.Controllers.pagination pg = ViewBag.pagination;

    int i = 0;
    string Mode = "i";
    if (string.IsNullOrEmpty(Request["cate"]))
    {
        Mode = "i";
    }
    else
    {
        Mode = "e";
    }
    string cate = Request["cate"] ?? "";
    string v_cate = ViewBag.cate ?? "";

    if (!string.IsNullOrEmpty(v_cate))
    {
        cate = v_cate;

    }


}


<link href="~/Content/assets/css/material.css" rel="stylesheet" />

<div  >
    @Html.Partial("~/Views/Sys/machine_menu.cshtml")
</div>

<form id="form2" name="form2" action="/board/m_photo_list" method="post">
    <input type="hidden" name="search_type" id="search_type" value="@ViewBag.search_type" />
    <input type="hidden" name="search_text" id="search_text" value="@ViewBag.search_all"/> 
</form>

    @using (Ajax.BeginForm("m_photo_action", "board", ajaxOpts, new { enctype = "multipart/form-data", id = "form1", name = "form1" }))
    {

        <input type="hidden" name="BD_BM_idx" id="BD_BM_idx" value="7"/>
        <input type="hidden" name="photo_type_search" id="photo_type_search"  value="7"/>
        

    <div class="container  sub_page">
        <div class="content" >           
            <p class="photo_type">
                <span  class="btn btn-danger" style="cursor: pointer;" onclick="show_add()">Create New</span>
                <span class="btn btn-primary" onclick="show_search()">Search</span>
                <span id="result"></span>
            </p>

        </div>

    <input type="hidden" name="cate" value="@Request["cate"]" />

        <div class="photo_type" style="display: table; width: 100%;">

            <div id="photo_head_save" style="display: none; width: 100%">

                <div class="form-horizontal" >

                   
                    <div class="form-group">
                        <label class="col-sm-2 control-label">Title <star>*</star></label>

                        <div class="col-md-8">
                            <input type="text" name="title" id="title" class="form-control" placeholder="Title" />

                        </div>
                    </div>

                    <div class="form-group ">

                        <label class="col-sm-2 control-label">Project</label>

                        <div class="col-md-6">

                            @Html.DropDownList("project_id", (SelectList)ViewBag.세팅, "No Select", new { @class = "form-control" })
                         
                        </div>

                    </div>

                    <div class="form-group " >

                        <label class="col-sm-2 control-label">Machine <star>*</star></label>
                        <div class="col-md-6">

                            @Html.DropDownList("machine_id", (SelectList)ViewBag.장비, "No Select", new { @class = "form-control" })

                        </div>

                   

                    </div>

                    <div class="form-group">
                        <label class="col-sm-2 control-label">Find Image </label>
                        <div class="col-md-3">

                            <span class="btn btn-rose btn-round btn-file col-md-4 form-control" style="line-height:10px ">
                                <span class="fileinput-new">Select </span>
                                <span class="fileinput-exists">image</span>
                                <input type="hidden"><input name="myfile" id="myfile" multiple type="file">
                                                     <span class="ripple-container"></span>
                            </span>

                          

                        </div>
                        

                            <div class="col-md-4">
                                <div class="btn btn-default btn-fill btn-wd   btn-info col-md-2" onclick="save_it() " style="margin-left: 15px;height:30px;line-height:10px"> Save</div>
                            </div>
                        

                        </div>

               
                
                    <hr />
                </div>

            </div>


            <div id="photo_head_search" style=" width: 100%">
                <div class="form-horizontal">
                    <div class="form-group" >
                        <label class="col-sm-2" style="width:100px;position:relative;top:10px;text-indent:5px;" >Search</label>
                        <div class="col-md-3"  style="position:relative;top:10px;">
                            @Html.DropDownList("machine_id_search", (SelectList)ViewBag.장비, "No Select", new { @class = "form-control" })

                            </div>
                        <div class="col-md-3" rel="tooltip" title="Author, Subject searchable" style="position:relative;top:10px;">
                            <input type="text" id="_search_all"  name="_search_all" class="form-control" value="@ViewBag.search_all" />
                        </div>

                        <div class="col-md-2">
                           <div class="btn btn-default btn-fill btn-wd   btn-info col-md-2" onclick="search_it() " style="margin-left: 15px;height:30px;line-height:10px"> Search</div>
                        </div>

                    </div>
               <hr />
                </div>
            </div>
            <div class="content " style="display: table; margin: auto; z-index: 1;">
                <div id="dialog"  style="display: none; z-index: 999;">
                    <img id="photo_big" />
                </div>


                @foreach (var item in Model)
                {
                    <div style="display: table; display: none; float: left; width: 160px; z-index: 1;">
                        <div><img class="opener" style="cursor: pointer; display: table; height: 120px; padding: 0 5px 5px 0px; width: 170px;" src="@ViewBag.LoadFileUrl@item.department_id/s_@item.BF_name" rel="tooltip" title="Title: @item.Board.BD_title   Date: @item.Board.BD_wdate.ToString("yy.MM.dd HH:mm ")  By  @item.Board.BD_writer " onclick="photo_show('@item.Board.BD_title', '@ViewBag.LoadFileUrl@item.department_id/@item.BF_name ') "  />
                        </div>
                        <div style="font-size: 11px;">
                            @item.Board.BD_title Date

                        </div>
                       
                        
                    </div>


                    <div class="card card-product" data-count="0" style="cursor: pointer; margin: 3px 0px 0px 0px; width: 180px;">
                        <div class="card-image" data-header-animation="true" onclick="photo_show('@item.Board.BD_title', '@ViewBag.LoadFileUrl@item.department_id/@item.BF_name ') "  style="cursor: pointer">
                                                    
                            <a href="#pablo">
                                @{
                                    string class_it = item.main_img;

                                    if (class_it == "Y")
                                    {
                                        <img  src="@ViewBag.LoadFileUrl/@item.department_id/s_@item.BF_name"  style="border:dotted 2px #e94e4e" rel="tooltip" title="Main Image" />
                                    }
                                    else
                                    {
                                        <img  src="@ViewBag.LoadFileUrl/@item.department_id/s_@item.BF_name" />
                                    }
                                }
                               
                            </a>        
                               
                        </div>
                        <div class="card-content" style="padding: 0">
                            <div class="card-actions">
                               @if (class_it != "Y")
                               {

                                <span rel="tooltip" title="Setting Main Image">
                                    <button class="btn btn-default btn-simple" data-placement="bottom" type="button" data-original-title="View" onclick="main_show('@item.BF_idx','@item.machine_id') " >
                                       
                                        <img src="~/images/common/view_icon.jpg"  style="cursor:help" />
                                    </button>
                                </span>
                               }
                               else
                               {
                                   <span style="font-size:0.8em;color:#e94e4e" rel="tooltip" title="This is representative image.">Main Image</span>
                               }


                                <button class="btn btn-danger btn-simple auth_check_it" data-placement="bottom" rel="tooltip" title="Deletion is possible only within 5 days. Only administrators can delete it." type="button" data-original-title="Remove" onclick=" photo_del(@item.BF_idx, @item.BD_BM_idx) ">
                                    <img src="~/images/common/s_icon_del.gif" />
                                </button>

                            </div>
                            <div class="stats" style="text-align: center;">
                                <a href="#pablo"><span style="font-size: 1em; font-weight: 600; text-align: center;">@item.Board.BD_title</span> </a>
                            </div>
                        </div>
                        <div class="card-footer" style="padding: 0">
                            <div class="card-description" style="font-size: 11px; position: relative; top: 5px;">
                                <span>@item.Board.BD_wdate.ToString("yy.MM.dd")</span>
                            </div>
                            <div class="stats pull-right">
                                <p class="category" style="font-size: 11px;"> @item.Board.BD_writer </p>
                            </div>
                        </div>
                    </div>


                    i++;
                }
            </div>
           
            



       


        </div>


        <hr />
        <div class="row">
            <div class="col-md-12 text-center">
                @Html.Partial("Pagination")
            </div>
        </div>

    </div>
    }
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<script src="https://code.jquery.com/jquery-1.12.4.js"> </script>

<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"> </script>

<script type="text/javascript">

    $(document).ready(function() {

        var machine_id = "@ViewBag.search_type";
    

        if (machine_id != "") {
            $('#machine_id_search option[value=' + machine_id + ']').attr('selected', 'selected');
        }
       
     
       

    });


    function main_show(idx,m_id) {

        
             var url = "/board/m_photo_list_mainset?idx=" + idx + "&m_id=" + m_id


        if (confirm('Would you like to set as the main image?')) {
        


            //로딩바=====================================================================================================================================================
            $('<div id="loading" style="position: absolute;z-index:20;"> <img src ="/images/common/ajax-loader11.gif" /></div>')
                .insertBefore('#result').ajaxStart(function () {
                    $(this).show();

                }).ajaxStop(function () {
                    $(this).hide();
                });
        //========================================================================================================================================================





            location.href = url;


        } else {
            return;
        }




    }

    function search() {
     

        location.href = "/board/m_photo_list/?cate=7";

    }

    function go_link(idx) {

        var cate = $("#BD_BM_idx").val();

        location.href = "/board/boardview/?idx=" + idx + "&cate=" + cate;

    }

    function go_write() {

        var cate = $("#BD_BM_idx").val();

        location.href = "/board/boardwrite/?cate=" + cate;

    }

    function show_add() {


        var check_it = $("#photo_head_save").css("display");

        if (check_it == "none") {

            $("#photo_head_save").css("display", "table");
            $("#photo_head_search").css("display", "none");

        } else {

            $("#photo_head_save").css("display", "none");
        }


    }

    function show_search() {


        var check_it = $("#photo_head_search").css("display");

        if (check_it == "none") {

            $("#photo_head_search").css("display", "table");
            $("#photo_head_save").css("display", "none");
        } else {

            $("#photo_head_search").css("display", "none");
        }


    }

    function save_it() {

        var formData = new FormData();
        var title = $("#title").val();

        var machine_id = $("#machine_id").val();
        

        if (title == "") {
            alert("Fill in the blanks.");
            $("#title").focus();
            return;
        }


        if (machine_id == "") {
            alert("Select Machine");
            $("#machine_id").focus();
            return;
        }

      

        formData.append("file", $('#myfile')[0].files[0]);


        var ext = $('#myfile').val().split('.').pop().toLowerCase();


        if (ext.length > 0) {

            if ($.inArray(ext, ["gif", "png", "jpg", "jpeg"]) == -1) {
                alert("Only images type : gif,png,jpg ");
                return false;
            }

        }
        else {
            alert("Please select an image.");
            return;
        }
        var _name = $('input[name = "myfile"]');

        for (var k = 0; k < _name.length; ++k) {

            var formData = new FormData();

            for (var i = 0; i < _name.get(0).files.length; ++i) {


                formData.append("file", $('input[name = "myfile"]')[k].files[i]);


            }


        }


        //로딩바=====================================================================================================================================================
        $('<div id="loading" style="position: absolute;z-index:20;"> <img src ="/images/common/ajax-loader11.gif" /></div>')
            .insertBefore('#result').ajaxStart(function () {
                $(this).show();

            }).ajaxStop(function () {
                $(this).hide();
            });
        //========================================================================================================================================================




        $("#form1").submit();
    }

    function photo_del(i, c) {

        if (confirm('Are you sure you want to delete it?')) {


            location.href = "/Board/m_Photo_Del?idx=" + i + "&cate=" + c;
        } else {
            return;
        }


    }

    function photo_view(_a) {

        demo.showSwal('photo_view', _a);
    }

    function search_it(){

        var search_type = $('#machine_id_search option:selected').val()

       

        var search_text = $("#_search_all").val();

        $("#search_type").attr("value", search_type);
        $("#search_text").attr("value", search_text);

        //로딩바=====================================================================================================================================================
        $('<div id="loading" style="position: absolute;z-index:20;"> <img src ="/images/common/ajax-loader11.gif" /></div>')
            .insertBefore('#result').ajaxStart(function () {
                $(this).show();

            }).ajaxStop(function () {
                $(this).hide();
            });
        //========================================================================================================================================================


        $("#form2").submit();
    }
</script>
<script>

    $(function() {

        $("#dialog").dialog({
            autoOpen: false,

         

            width: 800,

            modal: true,
        });


    });

    function photo_show(title, url) {
        $("#dialog").css("display", "block");

        $(".ui-dialog-title").html(title);
        $("#photo_big").attr("src", url);
        $("#photo_big").css("max-width", "760px").css("cursor", "pointer");

        $("#dialog").dialog("open");

        $("#photo_big").on("click", function() {
            //  alert("aa");
            $("#dialog").dialog("close");


        });
    }

</script>